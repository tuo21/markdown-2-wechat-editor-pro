# 主题编辑器实时预览优化计划

## 问题分析

### 问题 1：编辑主题弹窗没有背景色
**现状**：ThemeEditor.vue 第 91 行使用 `bg-black/50` 作为遮罩层，弹窗使用 `bg-white dark:bg-gray-900`。在暗色模式下可能不够明显。

**原因**：弹窗容器可能没有正确设置背景色，或者 z-index 层级问题。

### 问题 2：无法实时预览
**现状**：
- ThemeEditor 通过 `emit('update:theme', ...)` 发送更新事件
- StyleConfig.vue 没有监听 `update:theme` 事件
- App.vue 的 `currentTheme` 没有被编辑中的主题更新

**原因**：缺少实时预览的数据流机制。

### 问题 3：样式编辑区需要调整
**现状**：样式编辑区在弹窗内部，无法看到右侧预览区。

**解决方案**：将主题编辑器改为侧边栏模式，左侧编辑样式，右侧实时预览。

---

## 优化方案

### 方案概述
将 ThemeEditor 从弹窗模式改为侧边栏模式，实现左右分栏布局：
- 左侧：样式编辑面板
- 右侧：实时预览区域

### 具体改动

#### 1. 修改 ThemeEditor.vue 布局
- 移除弹窗遮罩层
- 改为全屏侧边栏布局
- 左侧固定宽度样式编辑区
- 右侧预览区（复用 Preview 组件）

#### 2. 添加实时预览机制
- ThemeEditor 内部维护 `previewTheme` 状态
- 样式变化时立即更新 `previewTheme`
- 右侧 Preview 组件绑定 `previewTheme`

#### 3. 优化样式编辑面板
- 将 Tab 改为左侧垂直导航
- 每个元素类型一个可展开的面板
- 添加更多预设值选择器（字体大小、字重等）

---

## 文件改动清单

### 1. ThemeEditor.vue（重写）
```
主要改动：
- 布局从弹窗改为全屏侧边栏
- 左侧：垂直 Tab 导航 + 样式编辑表单
- 右侧：实时预览区域
- 添加关闭按钮和保存/取消操作栏
- 内置 Preview 组件实现实时预览
```

### 2. StyleConfig.vue
```
主要改动：
- 移除 ThemeEditor 的弹窗调用
- 改为触发 App.vue 打开侧边栏编辑器
- 添加 `@open-editor` 事件
```

### 3. App.vue
```
主要改动：
- 添加 `isThemeEditorOpen` 状态
- 添加 `editingTheme` 状态
- 监听编辑中的主题变化，实时更新预览
- 处理编辑器打开/关闭/保存逻辑
```

---

## 新布局设计

```
┌─────────────────────────────────────────────────────────────┐
│  工具栏 (Toolbar)                                            │
├─────────────────────────────────────────────────────────────┤
│  主题选择栏 (StyleConfig)                                     │
├──────────────────────────┬──────────────────────────────────┤
│                          │                                  │
│   样式编辑面板            │     实时预览区域                  │
│   (左侧固定宽度 400px)    │     (右侧自适应)                  │
│                          │                                  │
│   ┌──────────────────┐   │   ┌──────────────────────────┐   │
│   │ 全局样式         │   │   │                          │   │
│   ├──────────────────┤   │   │    微信预览              │   │
│   │ 标题样式         │   │   │    (375px 宽度)          │   │
│   │  - H1           │   │   │                          │   │
│   │  - H2           │   │   │                          │   │
│   │  - H3           │   │   │                          │   │
│   ├──────────────────┤   │   │                          │   │
│   │ 内容块样式       │   │   │                          │   │
│   │  - 段落         │   │   │                          │   │
│   │  - 引用         │   │   │                          │   │
│   │  - 代码块       │   │   │                          │   │
│   │  - ...          │   │   │                          │   │
│   ├──────────────────┤   │   │                          │   │
│   │ 其他样式         │   │   │                          │   │
│   └──────────────────┘   │   └──────────────────────────┘   │
│                          │                                  │
│   [取消]  [保存主题]      │                                  │
│                          │                                  │
└──────────────────────────┴──────────────────────────────────┘
```

---

## 实现步骤

1. **重写 ThemeEditor.vue**
   - 改为全屏侧边栏布局
   - 左侧垂直导航 + 样式编辑表单
   - 右侧嵌入 Preview 组件
   - 实现实时预览数据绑定

2. **修改 StyleConfig.vue**
   - 发出 `open-editor` 事件而非直接控制弹窗
   - 简化组件逻辑

3. **修改 App.vue**
   - 添加主题编辑器状态管理
   - 处理编辑器的打开/关闭/保存
   - 编辑时隐藏主界面，显示编辑器

---

## 预期效果

1. 点击「新建」或「编辑」按钮时，主界面切换为主题编辑器界面
2. 左侧调整样式参数，右侧实时看到预览效果
3. 点击「保存」保存主题，点击「取消」放弃修改
4. 编辑器有清晰的背景色，不会看到底层内容
